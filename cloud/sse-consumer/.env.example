# Example environment variables for local dev
SERVICE_AUTH_TOKEN=devtoken

# Base mount path where the working directory lives.
# Local dev: bind-mount a host folder to /mnt/work (see scripts/dev.sh)
# Cloud Run: either mount your GCS bucket to /mnt/work using a Cloud Storage volume
#   (recommended for direct FS access) OR use the JSON API sync described below.
WORK_ROOT=/mnt/work

# Optional: bucket and fuse flags for Cloud Storage mounting
# - GCS_BUCKET: name of the bucket to mount at WORK_ROOT (e.g. my-project-work-bucket)
# - ENABLE_GCS_FUSE: set to true if using gcsfuse directly; for Cloud Run "cloud-storage"
#   volumes you can leave this false. These vars are provided for consistency/documentation;
#   the service itself just needs WORK_ROOT to be writable.
GCS_BUCKET=
ENABLE_GCS_FUSE=false

# Optional template to derive a per-request working directory under WORK_ROOT.
# Tokens: {projectId} {workspaceId} {sessionId} {userId}
# Example default results in: /mnt/work/<projectId>/<workspaceId>
WORK_PREFIX_TEMPLATE={projectId}/{workspaceId}

# Upstream workflows URL and optional audience for IAM auth
WORKFLOWS_BASE_URL=http://host.docker.internal:3000
WORKFLOWS_AUDIENCE=http://host.docker.internal:3000

# Tuning
EVENTS_HEARTBEAT_MS=15000
RECONNECT_BACKOFF_MS=1000
RUN_COMMAND_TIMEOUT_SECONDS=120
READ_FILE_MAX_BYTES=200000
OUTPUT_MAX_BYTES=50000

# --- Optional GCS JSON API mirror to WORK_ROOT (download + upload) ---
# When the producer provides a downscoped token (X-Gcs-Token) and you configure a
# bucket/prefix, the consumer can mirror remote objects into the per-request work root
# and push local changes back to GCS. Upload is enabled by default; set to 0 to disable.
# Note: If you mount the bucket directly at WORK_ROOT, you typically do NOT need this
# JSON API sync.

# Bucket that contains per-tenant workspaces to mirror
# (Used only by JSON API sync; not required when mounting the bucket as a volume.)
GCS_PREFIX_TEMPLATE={userId}/{projectId}/{workspaceId}/{sessionId}/
SYNC_ON_START=1
SYNC_INTERVAL_MS=15000
GCS_API_BASE=https://www.googleapis.com
GCS_DOWNLOAD_CONCURRENCY=8
GCS_ENABLE_UPLOAD=1
GCS_UPLOAD_CONCURRENCY=4
# Diagnostics for sync permissions and requests
#GCS_DEBUG=1
